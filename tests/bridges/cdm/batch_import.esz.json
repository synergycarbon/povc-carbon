{
  "circuit": "cdm_bridge",
  "description": "CDM batch import of legacy CER credits into SynergyCarbon",
  "vectors": [
    {
      "id": "legacy-csv-import",
      "description": "Import legacy CDM credits from pre-parsed CSV data",
      "tags": ["batch-import", "legacy", "happy-path"],
      "inputs": {
        "legacy_credits": [
          {
            "serial_number": "CDM-CER-2015-IN-0001",
            "project_activity_ref": "PA-4521",
            "component_project_activity_id": "CPA-4521-01",
            "host_party": "India",
            "crediting_period_start": "2014-01-01",
            "crediting_period_end": "2021-12-31",
            "methodology": "AMS-I.D v18",
            "vintage": 2015,
            "quantity_tco2e": 5000,
            "status": "active",
            "issuance_date": "2016-03-15"
          },
          {
            "serial_number": "CDM-CER-2016-BR-0042",
            "project_activity_ref": "PA-7890",
            "component_project_activity_id": "CPA-7890-03",
            "host_party": "Brazil",
            "crediting_period_start": "2015-01-01",
            "crediting_period_end": "2022-12-31",
            "methodology": "ACM0002 v19",
            "vintage": 2016,
            "quantity_tco2e": 12500,
            "status": "active",
            "issuance_date": "2017-06-20"
          }
        ],
        "config": {
          "skip_duplicates": true,
          "sc_serial_prefix": "SC-CDM"
        }
      },
      "expected_outputs": {
        "result": {
          "imported": 2,
          "skipped_duplicates": 0,
          "skipped_errors": 0
        },
        "mapping_states": [
          {
            "cdm_serial": "CDM-CER-2015-IN-0001",
            "state": "REGISTERED",
            "bridge_locked": true,
            "host_country": "IND"
          },
          {
            "cdm_serial": "CDM-CER-2016-BR-0042",
            "state": "REGISTERED",
            "bridge_locked": true,
            "host_country": "BRA"
          }
        ]
      }
    },
    {
      "id": "duplicate-skip",
      "description": "Duplicate CDM serials are skipped during import",
      "tags": ["batch-import", "dedup", "skip"],
      "inputs": {
        "precondition": {
          "existing_mapping": {
            "cdm_serial": "CDM-CER-2015-IN-0001",
            "credit_id": "SC-CDM-2015-existing"
          }
        },
        "legacy_credits": [
          {
            "serial_number": "CDM-CER-2015-IN-0001",
            "project_activity_ref": "PA-4521",
            "component_project_activity_id": "CPA-4521-01",
            "host_party": "India",
            "methodology": "AMS-I.D v18",
            "vintage": 2015,
            "quantity_tco2e": 5000,
            "status": "active",
            "issuance_date": "2016-03-15"
          }
        ]
      },
      "expected_outputs": {
        "result": {
          "imported": 0,
          "skipped_duplicates": 1
        }
      }
    },
    {
      "id": "api-paginated-import",
      "description": "Import credits from CDM SOAP API with pagination",
      "tags": ["batch-import", "api", "pagination"],
      "inputs": {
        "query": {
          "project_ref": "PA-4521",
          "vintage_year_from": 2014,
          "vintage_year_to": 2020,
          "page_size": 2
        },
        "api_responses": [
          {
            "credits": [
              { "cdm_serial": "CDM-CER-2014-IN-0001", "vintage_year": 2014, "tonnes_co2e": 3200 },
              { "cdm_serial": "CDM-CER-2015-IN-0002", "vintage_year": 2015, "tonnes_co2e": 4100 }
            ],
            "total_count": 4,
            "next_page_token": "page2"
          },
          {
            "credits": [
              { "cdm_serial": "CDM-CER-2016-IN-0003", "vintage_year": 2016, "tonnes_co2e": 5500 },
              { "cdm_serial": "CDM-CER-2017-IN-0004", "vintage_year": 2017, "tonnes_co2e": 6200 }
            ],
            "total_count": 4,
            "next_page_token": null
          }
        ]
      },
      "expected_outputs": {
        "result": {
          "total_queried": 4,
          "imported": 4,
          "skipped_duplicates": 0
        }
      }
    }
  ]
}
