---
import Base from '../layouts/Base.astro';
---

<Base title="API Reference" description="SynergyCarbon REST API documentation: 14 endpoints, ML-DSA-87 JWT authentication, webhooks, and code examples.">

  <header class="page-hero">
    <h1>API Reference</h1>
    <p>
      14 REST endpoints across 7 groups. Post-quantum authentication,
      real-time webhooks, and comprehensive SDKs.
    </p>
  </header>

  <!-- Overview -->
  <section class="section">
    <h2 class="section-title reveal">Endpoint Overview</h2>
    <p class="section-subtitle reveal delay-1">
      All endpoints use JSON request/response bodies and ML-DSA-87 JWT bearer tokens.
    </p>

    <div class="reveal" style="max-width: 900px; margin: 0 auto;">
      <div class="endpoint-group">
        <h3>Credits</h3>
        <div class="endpoint">
          <span class="endpoint-method method-get">GET</span>
          <span class="endpoint-path">/v1/credits</span>
          <span class="endpoint-desc">List credits with filtering</span>
        </div>
        <div class="endpoint">
          <span class="endpoint-method method-get">GET</span>
          <span class="endpoint-path">/v1/credits/:id</span>
          <span class="endpoint-desc">Get credit details + provenance</span>
        </div>
      </div>

      <div class="endpoint-group">
        <h3>Marketplace</h3>
        <div class="endpoint">
          <span class="endpoint-method method-get">GET</span>
          <span class="endpoint-path">/v1/marketplace/listings</span>
          <span class="endpoint-desc">Browse active listings</span>
        </div>
        <div class="endpoint">
          <span class="endpoint-method method-post">POST</span>
          <span class="endpoint-path">/v1/marketplace/listings</span>
          <span class="endpoint-desc">Create a new listing</span>
        </div>
        <div class="endpoint">
          <span class="endpoint-method method-post">POST</span>
          <span class="endpoint-path">/v1/marketplace/trade</span>
          <span class="endpoint-desc">Execute a trade</span>
        </div>
      </div>

      <div class="endpoint-group">
        <h3>Forward Contracts</h3>
        <div class="endpoint">
          <span class="endpoint-method method-post">POST</span>
          <span class="endpoint-path">/v1/contracts</span>
          <span class="endpoint-desc">Create forward contract</span>
        </div>
        <div class="endpoint">
          <span class="endpoint-method method-put">PUT</span>
          <span class="endpoint-path">/v1/contracts/:id/transition</span>
          <span class="endpoint-desc">Advance contract state</span>
        </div>
      </div>

      <div class="endpoint-group">
        <h3>Retirement</h3>
        <div class="endpoint">
          <span class="endpoint-method method-post">POST</span>
          <span class="endpoint-path">/v1/retirement</span>
          <span class="endpoint-desc">Retire credits</span>
        </div>
        <div class="endpoint">
          <span class="endpoint-method method-get">GET</span>
          <span class="endpoint-path">/v1/retirement/:id/certificate</span>
          <span class="endpoint-desc">Download retirement certificate</span>
        </div>
      </div>

      <div class="endpoint-group">
        <h3>Attestations</h3>
        <div class="endpoint">
          <span class="endpoint-method method-get">GET</span>
          <span class="endpoint-path">/v1/attestations</span>
          <span class="endpoint-desc">Query attestation history</span>
        </div>
        <div class="endpoint">
          <span class="endpoint-method method-get">GET</span>
          <span class="endpoint-path">/v1/attestations/:id/verify</span>
          <span class="endpoint-desc">Verify attestation signatures</span>
        </div>
      </div>

      <div class="endpoint-group">
        <h3>Analytics</h3>
        <div class="endpoint">
          <span class="endpoint-method method-get">GET</span>
          <span class="endpoint-path">/v1/analytics/yield-forecast</span>
          <span class="endpoint-desc">ML yield predictions</span>
        </div>
        <div class="endpoint">
          <span class="endpoint-method method-get">GET</span>
          <span class="endpoint-path">/v1/analytics/pricing</span>
          <span class="endpoint-desc">Forward pricing oracle</span>
        </div>
      </div>

      <div class="endpoint-group">
        <h3>Impact</h3>
        <div class="endpoint">
          <span class="endpoint-method method-get">GET</span>
          <span class="endpoint-path">/v1/impact/summary</span>
          <span class="endpoint-desc">Org-level impact metrics</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Authentication -->
  <section class="section-surface">
    <div class="section" style="padding-top: 0; padding-bottom: 0;">
      <h2 class="section-title reveal">Authentication</h2>
      <p class="section-subtitle reveal delay-1">
        Post-quantum JWT tokens signed with ML-DSA-87.
      </p>

      <div class="detail-grid">
        <div class="detail-card reveal delay-1">
          <h3>ML-DSA-87 JWT</h3>
          <p>
            Authenticate via SPARK visual challenge to receive a JWT signed with
            your ML-DSA-87 key pair. Tokens include tenant ID, role, and scope.
            15-minute expiry with refresh token rotation.
          </p>
        </div>
        <div class="detail-card reveal delay-2">
          <h3>API Keys</h3>
          <p>
            Service-to-service authentication uses ML-DSA-87 signed API keys.
            Scoped to specific endpoint groups with configurable rate limits.
            Rotatable without downtime.
          </p>
        </div>
        <div class="detail-card reveal delay-3">
          <h3>Webhook Signatures</h3>
          <p>
            All webhook payloads are signed with your tenant&rsquo;s ML-DSA-87
            public key. Verify signatures server-side to ensure payload
            authenticity and integrity.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Webhooks -->
  <section class="section">
    <h2 class="section-title reveal">Webhooks</h2>
    <p class="section-subtitle reveal delay-1">
      8 event types for real-time integration with your systems.
    </p>

    <div style="max-width: 800px; margin: 0 auto;">
      <table class="info-table reveal">
        <thead>
          <tr>
            <th>Event</th>
            <th>Trigger</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><code>credit.minted</code></td><td>New credit verified and minted</td></tr>
          <tr><td><code>credit.listed</code></td><td>Credit listed on marketplace</td></tr>
          <tr><td><code>credit.sold</code></td><td>Trade completed</td></tr>
          <tr><td><code>credit.retired</code></td><td>Credit permanently retired</td></tr>
          <tr><td><code>contract.state_change</code></td><td>Forward contract state transition</td></tr>
          <tr><td><code>contract.delivery</code></td><td>Credits delivered against contract</td></tr>
          <tr><td><code>attestation.anomaly</code></td><td>Anomaly detected in attestation data</td></tr>
          <tr><td><code>node.status_change</code></td><td>Witness node online/offline/error</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Rate Limits -->
  <section class="section-surface">
    <div class="section" style="padding-top: 0; padding-bottom: 0;">
      <h2 class="section-title reveal">Rate Limits</h2>
      <p class="section-subtitle reveal delay-1">
        Generous defaults with burst allowances.
      </p>

      <div style="max-width: 700px; margin: 0 auto;">
        <table class="info-table reveal">
          <thead>
            <tr>
              <th>Tier</th>
              <th>Rate</th>
              <th>Burst</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Standard</td><td>100 req/s</td><td>200 req burst</td></tr>
            <tr><td>Enterprise</td><td>1,000 req/s</td><td>2,000 req burst</td></tr>
            <tr><td>Webhooks (outbound)</td><td>Unlimited</td><td>&mdash;</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Code Examples -->
  <section class="section">
    <h2 class="section-title reveal">Code Examples</h2>
    <p class="section-subtitle reveal delay-1">
      Common operations with the SynergyCarbon API.
    </p>

    <div style="max-width: 800px; margin: 0 auto;">
      <h3 style="color: var(--sc-primary-dark); margin-bottom: 0.75rem;" class="reveal">Issue a Credit (after verification)</h3>
      <div class="code-block reveal delay-1">
        <code><span class="comment"># POST /v1/credits — requires operator role</span>
curl -X POST https://api.synergycarbon.io/v1/credits \
  -H <span class="string">"Authorization: Bearer $JWT"</span> \
  -H <span class="string">"Content-Type: application/json"</span> \
  -d <span class="string">'{
    "attestation_id": "att_7f3a...",
    "methodology": "cdm_acm0001",
    "quantity_tco2e": 12.4,
    "source_type": "solar",
    "vintage": "2026-Q1"
  }'</span></code>
      </div>

      <h3 style="color: var(--sc-primary-dark); margin: 2rem 0 0.75rem;" class="reveal">Retire Credits</h3>
      <div class="code-block reveal delay-1">
        <code><span class="comment"># POST /v1/retirement — permanent and irreversible</span>
curl -X POST https://api.synergycarbon.io/v1/retirement \
  -H <span class="string">"Authorization: Bearer $JWT"</span> \
  -H <span class="string">"Content-Type: application/json"</span> \
  -d <span class="string">'{
    "credit_ids": ["cr_a1b2...", "cr_c3d4..."],
    "reason": "Annual ESG commitment offset",
    "beneficiary": "Acme Corporation",
    "registry_sync": ["verra", "gold_standard"]
  }'</span></code>
      </div>

      <h3 style="color: var(--sc-primary-dark); margin: 2rem 0 0.75rem;" class="reveal">Subscribe to Webhooks</h3>
      <div class="code-block reveal delay-1">
        <code><span class="comment"># Register a webhook endpoint</span>
curl -X POST https://api.synergycarbon.io/v1/webhooks \
  -H <span class="string">"Authorization: Bearer $JWT"</span> \
  -d <span class="string">'{
    "url": "https://your-app.com/webhooks/sc",
    "events": ["credit.minted", "credit.retired"],
    "secret": "whsec_..."
  }'</span></code>
      </div>
    </div>
  </section>

  <!-- OpenAPI Spec Link -->
  <section class="section-surface" style="text-align: center; padding-bottom: 5rem;">
    <h2 class="section-title reveal">Full OpenAPI Specification</h2>
    <p class="section-subtitle reveal delay-1">
      Download the complete OpenAPI 3.1 spec for code generation and testing.
    </p>
    <div class="reveal delay-2">
      <a href="https://github.com/synergycarbon/povc-carbon/blob/main/api/openapi.yaml" class="btn-primary" style="margin-right: 0.75rem;">
        View OpenAPI Spec
      </a>
      <a href="https://console.synergycarbon.io?demo=true" class="btn-outline" style="color: var(--sc-primary-dark); border-color: var(--sc-primary-dark);">
        Try Demo Console
      </a>
    </div>
  </section>

</Base>
